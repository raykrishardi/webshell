<!doctype html>
  <html>
    <head>
      <link rel="stylesheet" href="./node_modules/xterm/css/xterm.css" />
      <script src="./node_modules/xterm/lib/xterm.js"></script>
      <script src="./node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
  <style>
    div#terminal {
      position: fixed;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      background: #181818;
      z-index: 10;
    }
  </style>
    </head>
    <body>
      <div id="terminal"></div>
      <script>
        var terminal = new Terminal({
          screenKeys: true,
          useStyle: true,
          cursorBlink: true,
          fullscreenWin: true,
          maximizeWin: true,
          screenReaderMode: true,
          cols: 128,
        });
        terminal.open(document.getElementById('terminal'));


        // Init and load addon
        var fitAddon = new FitAddon.FitAddon();
        terminal.loadAddon(fitAddon);


        var command = "";

        function prompt(terminal) {
         command = '';
         terminal.write('\r\n$ ');
        }

        prompt(terminal)
        fitAddon.fit();

        terminal._initialized = true;     
        terminal.onData(e => {
         switch (e) {
           case '\u0003': // Ctrl+C
             terminal.write('^C');
             prompt(terminal);
             break;
           case '\r': // Enter
             if (command === '') {
              prompt(terminal);
             } else {
             {{/* TODO: Websocket send */}}
              {{/* runCommand(terminal, command); */}}
              command = '';
             }
             break;
           case '\u007F': // Backspace (DEL)
             // Do not delete the prompt
             if (terminal._core.buffer.x > 2) {
               terminal.write('\b \b');
               if (command.length > 0) {
                 command = command.substr(0, command.length - 1);
               }
             }
             break;
           default: // Print all other characters for demo
             if (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\u00a0') {
               command += e;
               terminal.write(e);
             }
         }

         console.log(command)
        });

      </script>
    </body>
  </html>